

# AWS Athena Explorer for Migration Hub (Application Discovery Service)

## 📘 Overview

When you use **AWS Application Discovery Service (ADS)** to collect on-prem server data, the discovered information (servers, processes, connections, performance metrics, etc.) is stored in **AWS Migration Hub**.

Using **Amazon Athena**, you can **query and analyze** this discovery data using SQL directly in browser.

---

## 🧩 Prerequisites

Before starting:

* You’ve already installed **Discovery Agents** and they’re reporting data to **Migration Hub**.
* You have set a **Migration Home Region**.
* You have **Athena** permissions:

  * `AmazonAthenaFullAccess`
  * `AWSMigrationHubDiscoveryAccess`
  * `AmazonS3FullAccess` (for Athena query result storage)

---

## 🧭 Step 1: Open Migration Hub → Servers

1. Go to **AWS Console → Migration Hub → Servers**
2. You’ll see a list of all discovered **servers** from your on-prem environment.

   * Each entry includes **hostname, OS, CPU, memory, applications, and performance metrics**.

---

## 🔍 Step 2: Export Discovery Data to Athena Explorer

1. In the **Servers** tab, select **All servers** (or select specific ones).
2. Click **Actions → Explore in Athena**.
3. You’ll be redirected to **Amazon Athena Query Editor**.
4. A **preconfigured Athena database and table** (for Application Discovery data) will appear in the left panel.

---

## 🗃️ Step 3: Understand the Athena Table Structure

The Migration Hub creates a database like:

```
Database: application_discovery_service_database
Table: discovered_servers
```

Typical columns in the table:

| Column Name            | Description                                  |
| ---------------------- | -------------------------------------------- |
| `server_id`            | Unique identifier for each discovered server |
| `hostname`             | Server name                                  |
| `os_name`              | Operating system name                        |
| `os_version`           | Version of OS                                |
| `cpu_cores`            | Number of CPU cores                          |
| `cpu_usage_percent`    | Average CPU utilization                      |
| `memory_total_mb`      | Total memory in MB                           |
| `memory_usage_percent` | Memory usage percentage                      |
| `network_in_kbps`      | Average inbound network (KB/s)               |
| `network_out_kbps`     | Average outbound network (KB/s)              |
| `uptime_hours`         | Server uptime                                |
| `last_updated_time`    | Last update timestamp                        |

---

## 💻 Step 4: Run Athena Queries

Once inside Athena, you can run SQL queries directly on your discovery data.

---

### 🔹 **Query 1: View All Discovered Servers**

```sql
SELECT
  server_id,
  hostname,
  os_name,
  os_version,
  cpu_cores,
  memory_total_mb
FROM discovered_servers
ORDER BY hostname;
```

📊 **Sample Output:**

| server_id | hostname     | os_name        | os_version | cpu_cores | memory_total_mb |
| --------- | ------------ | -------------- | ---------- | --------- | --------------- |
| srv-001   | AppServer-01 | Windows Server | 2019       | 4         | 8192            |
| srv-002   | DBServer-01  | Ubuntu         | 20.04      | 8         | 16384           |

---

### 🔹 **Query 2: Find High CPU Utilization Servers**

```sql
SELECT
  hostname,
  cpu_usage_percent,
  memory_usage_percent
FROM discovered_servers
WHERE cpu_usage_percent > 80
ORDER BY cpu_usage_percent DESC;
```

📊 **Sample Output:**

| hostname     | cpu_usage_percent | memory_usage_percent |
| ------------ | ----------------- | -------------------- |
| AppServer-03 | 95.2              | 70.1                 |
| WebServer-02 | 88.5              | 65.0                 |

---

### 🔹 **Query 3: Identify Servers with Low Memory Availability**

```sql
SELECT
  hostname,
  memory_total_mb,
  memory_usage_percent
FROM discovered_servers
WHERE memory_usage_percent > 85;
```

📊 **Sample Output:**

| hostname     | memory_total_mb | memory_usage_percent |
| ------------ | --------------- | -------------------- |
| DBServer-02  | 8192            | 90.3                 |
| AppServer-05 | 4096            | 88.7                 |

---

### 🔹 **Query 4: Count Servers by Operating System**

```sql
SELECT
  os_name,
  COUNT(*) AS total_servers
FROM discovered_servers
GROUP BY os_name
ORDER BY total_servers DESC;
```

📊 **Sample Output:**

| os_name        | total_servers |
| -------------- | ------------- |
| Windows Server | 12            |
| Ubuntu         | 8             |
| RedHat         | 3             |

---

### 🔹 **Query 5: Average CPU and Memory Utilization**

```sql
SELECT
  ROUND(AVG(cpu_usage_percent), 2) AS avg_cpu_usage,
  ROUND(AVG(memory_usage_percent), 2) AS avg_memory_usage
FROM discovered_servers;
```

📊 **Sample Output:**

| avg_cpu_usage | avg_memory_usage |
| ------------- | ---------------- |
| 54.32         | 61.24            |

---

### 🔹 **Query 6: Find Recently Updated Servers**

```sql
SELECT
  hostname,
  os_name,
  last_updated_time
FROM discovered_servers
WHERE last_updated_time > date_add('day', -7, current_date);
```

📊 **Sample Output:**

| hostname     | os_name        | last_updated_time   |
| ------------ | -------------- | ------------------- |
| WebServer-01 | Ubuntu         | 2025-10-25 09:32:10 |
| DBServer-03  | Windows Server | 2025-10-26 14:45:02 |

---

## 📂 Step 5: Save and Export Athena Query Results

1. After running queries, click **“Save as” → Name your query** (e.g., `HighCPU_Analysis`)
2. To export:

   * Click **Download results (.csv)**
   * Or store results automatically in **Amazon S3** (set in Athena’s settings)

---

## 🧠 Step 6: Best Practices

* Always use the **same region** as your **Migration Hub home region** for Athena queries.
* Use **SQL filters (WHERE, GROUP BY)** to limit data scanned (reduces Athena costs).
* Save reusable queries in Athena’s **Saved Queries** feature.
* Use **QuickSight** to visualize the same data from Athena for dashboards.

---

## ✅ Summary

| Step | Action                               | Purpose                                           |
| ---- | ------------------------------------ | ------------------------------------------------- |
| 1    | Go to Migration Hub → Servers        | View discovered servers                           |
| 2    | Select → Actions → Explore in Athena | Launch Athena query editor                        |
| 3    | Run SQL Queries                      | Analyze performance, utilization, OS distribution |
| 4    | Save & Export                        | Keep results for migration planning               |

